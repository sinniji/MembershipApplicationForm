<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>入会申込書</title>
    <style>
        /* --- CSSは変更ありませんが、そのまま利用できるように記載します --- */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Hiragino Sans', 'Meiryo', sans-serif; padding: 20px; background-color: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        h1 { text-align: center; margin-bottom: 30px; color: #333; font-size: 24px; }
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; color: #555; }
        
        input[type="text"], input[type="email"], input[type="number"], select, textarea {
            width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; box-sizing: border-box;
        }
        
        .form-field { margin-bottom: 16px; }
        .form-row { display: flex; gap: 16px; margin-bottom: 16px; }
        .width-25 { flex-basis: 25%; }
        .width-50 { flex-basis: 50%; }        
        .width-75 { flex-basis: 75%; }        
        .dropdown { background-color: #e0f7fa; }
        .dropdown-required { background-color: #fffacd; }
        .text-input { background-color: #e0f7fa; }
        .text-required-input { background-color: #fffacd; }
        
        .checkbox-group { display: flex; flex-wrap: wrap; gap: 15px; margin-top: 10px; }
        .vertical-items { flex-direction: column; align-items: flex-start; }
        .checkbox-item { display: flex; align-items: center; gap: 5px; }
        input[type="checkbox"] { width: 18px; height: 18px; }
        
        .section-title { text-align: center; margin-top: 30px; margin-bottom: 30px; color: #333; font-size: 22px; font-weight: bold; }
        hr.section-divider { border: 0; height: 1px; background-color: #ddd; margin: 40px 0; }
        
        .submit-btn { width: 100%; padding: 15px; background-color: #4CAF50; color: white; border: none; border-radius: 4px; font-size: 16px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        .submit-btn:hover { background-color: #45a049; }
        .submit-btn:disabled { background-color: #ccc; cursor: not-allowed; }
        
        .message { padding: 15px; margin: 20px 0; border-radius: 4px; display: none; }
        .message.success { display: block; background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .message.error { display: block; background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        
        .section-note { margin-bottom: 25px; padding: 15px; background-color: #f9f9f9; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; line-height: 1.6; color: #333; }
        .section-note p { margin: 0 0 5px 0; }
        .section-note p:last-child { margin-bottom: 0; }
        
        .checkbox-item label { font-weight: normal; }
        legend { font-weight: normal; }
        
        /* --- 追加スタイル: 注意書き用 --- */
        .notice-text { color: #d32f2f; font-weight: bold; font-size: 0.95em; margin-top: 20px; line-height: 1.5; }

        /* --- 追加：より目立たせるための警告ボックススタイル --- */
        .important-notice {
            background-color: #fff3cd; /* 薄い黄色 */
            border: 2px solid #ffeeba; /* 枠線 */
            color: #856404; /* 濃い茶色（文字） */
            padding: 15px;
            margin: 20px 0;
            border-radius: 6px;
            font-size: 14px;
            line-height: 1.6;
        }
        
        .important-notice strong {
            color: #d32f2f; /* 赤色で強調 */
            font-size: 1.1em;
        }
        
        .important-notice ul {
            margin-top: 10px;
            margin-left: 20px;
        }
    </style>
</head>
<body>
    <div class="container">

        <div class="section-note">
            <p>【令和7年度 手話奉仕員養成講座を修了された方】 受講した会場名を選択してください。</p>
        </div>
        <select id="new_membership" name="new_membership" class="dropdown width-75">
            <option value="">選択してください</option>
            <option value="ウエルとばた">ウエルとばた</option>
            <option value="小倉北区生涯学習総合センター">小倉北区生涯学習総合センター</option>
            <option value="小倉南生涯学習センター">小倉南生涯学習センター</option>
            <option value="コムシティ">コムシティ</option>
        </select>

        
        <h1>入会申込書</h1>
        
        <div id="message" class="message"></div>
        
        <form id="membershipForm" class="h-adr">
        <input type="hidden" class="p-country-name" value="Japan">
            <div class="form-group">
                <label for="status">継続・新規 *</label>
                <select id="status" name="status" class="dropdown-required width-25" required>
                    <option value="">選択してください</option>
                    <option value="継続">継続</option>
                    <option value="新規">新規</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="branch">支部 *</label>
                <select id="branch" name="branch" class="dropdown-required width-50" required>
                    <option value="">選択してください</option>
                    <option value="門司">門司</option>
                    <option value="小倉北">小倉北</option>
                    <option value="小倉南">小倉南</option>
                    <option value="戸畑">戸畑</option>
                    <option value="若松">若松</option>
                    <option value="八幡東">八幡東</option>
                    <option value="八幡西">八幡西</option>
                    <option value="東昼間">東昼間</option>
                    <option value="西昼間">西昼間</option>
                </select>
            </div>
            
            <div class="form-row"> 
                <div class="form-field width-75"> <label for="furigana">ふりがな *</label>
                    <input type="text" id="furigana" name="furigana" class="text-required-input" required>
                </div>
                
                <div class="form-field width-25"> <label for="gender">性別 *</label>
                    <select id="gender" name="gender" class="dropdown-required" required> 
                        <option value="">選択してください</option>
                        <option value="男">男</option>
                        <option value="女">女</option>
                    </select>
                </div>
            
            </div>            
            <div class="form-row">
            
                <div class="form-field width-75">
                    <label for="name">氏名 *</label>
                    <input type="text" id="name" name="name" class="text-required-input" required>
                </div>
                
                <div class="form-field width-25">
                    <label for="age">年齢 *</label>
                    <input type="number" id="age" name="age" class="text-required-input" min="0" required>
                </div>    
                
            </div>
            <div class="form-field width-50" style="min-width: 100px;"> <label for="postal">郵便番号 *</label>
                <input type="text" id="postal" name="postal" class="text-required-input p-postal-code" placeholder="例: 123-4567" required>
            </div>
            <div class="form-group">
                <label for="address1">住所 1 *</label>
                <input type="text" id="address1" name="address1" class="text-required-input p-region p-locality p-street-address" required>
            </div>
            
            <div class="form-group">
                <label for="address2">住所 2</label>
                <input type="text" id="address2" name="address2" class="text-input">
            </div>
            
            <div class="form-group">
                <label for="phone">電話 *</label>
                <input type="text" id="phone" name="phone" class="text-required-input" required>
            </div>
            
            <div class="form-group">
                <label for="fax">FAX</label>
                <input type="text" id="fax" name="fax" class="text-input">
            </div>
            
            <div class="form-group">
                <label for="email">Mail *</label>
                <input type="email" id="email" name="email" class="text-required-input" required>
            </div>
            <div class="form-group">
                <label for="category">区分</label>
                <select id="category" name="category" class="dropdown width-50">
                    <option value="">選択してください</option>
                    <option value="小学生">小学生</option>
                    <option value="中学生">中学生</option>
                    <option value="高校生">高校生</option>
                    <option value="大学生">大学生</option>
                    <option value="勤労者">勤労者</option>
                    <option value="主婦">主婦</option>
                    <option value="退職者">退職者</option>
                    <option value="その他">その他</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>手話歴</label>
                <div class="checkbox-group vertical-items">
                    <div class="checkbox-item">
                        <input type="checkbox" id="training_course" name="training_course">
                        <label for="training_course">奉仕員養成講座終了</label>
                    </div>

                    <div class="checkbox-item">
                        
                        <fieldset style="border:0; padding:0; margin:0;">
                            <legend>通訳者養成講座終了</legend>
                            <span style="display: flex; align-items: center; gap: 10px; margin-left: 5px;">
                                (
                                <input type="checkbox" id="hop" name="hop">
                                <label for="hop">ホップ</label>
                                
                                <input type="checkbox" id="step" name="step">
                                <label for="step">ステップ</label>
                                
                                <input type="checkbox" id="jump" name="jump">
                                <label for="jump">ジャンプ</label>
                                )
                            </span>
                        </fieldset>
                    
                    </div>
                </div>
                
                <div class="form-group" style="margin-top: 15px;">
                    <label for="experience_years">手話歴年数</label>
                    <select id="experience_years" name="experience_years" class="dropdown width-50">
                        <option value="">選択してください</option>
                        <option value="1年">1年</option>
                        <option value="２〜５年">2〜5年</option>
                        <option value="６年〜１０年">6年〜10年</option>
                        <option value="11年〜15年">11年〜15年</option>
                        <option value="16年〜20年">16年〜20年</option>
                        <option value="21年以上">21年以上</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="other_experience">その他</label>
                    <input type="text" id="other_experience" name="other_experience" class="text-input">
                </div>
            </div>
            
            <div class="form-group"> 
                <label>ボランティア保険</label> 
                <div class="checkbox-group"> 
                    <div class="checkbox-item">
                        <input type="checkbox" id="new_policy" name="new_policy">
                        <label for="new_policy">新虹の会で加入する</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="own_policy" name="own_policy">
                        <label for="own_policy">他団体で加入済み</label>
                    </div>
                    <div class="form-field width-25">
                        <label for="organization_name">団体名</label>
                    <input type="text" id="organization_name" name="organization_name" class="text-input" placeholder="加入団体名">
                    </div>    

                </div>
            </div>
            
            <div class="form-group">
                <label>連絡は</label>
                <div class="checkbox-group">
                    <div class="checkbox-item">
                        <input type="checkbox" id="contact_mail" name="contact_mail">
                        <label for="contact_mail">メールを希望</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="contact_fax" name="contact_fax">
                        <label for="contact_fax">FAXを希望</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="contact_line" name="contact_line">
                        <label for="contact_line">LINEを希望</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="contact_no_line" name="contact_no_line">
                        <label for="contact_no_line">どれも希望しない</label>
                    </div>
                </div>
            </div>
            
            <div class="notice-text">
                <p>※送信後、入力されたメールアドレス宛に必ず自動返信メールが届きます。<br>
                届かない場合は、メールアドレスの誤りや迷惑メール設定をご確認ください。</p>
            </div>

<div class="important-notice">
    <strong>【重要：お申し込み後の流れ】</strong>
    <p>送信後、入力されたメールアドレス宛に<strong>「自動返信メール」</strong>が届きます。受付にてこのメールを提示して入会金をお支払いいただきますので、大切に保管してください。</p>
    
    <p style="margin-top: 10px; font-weight: bold;">もしメールが届かない場合は、以下をご確認ください：</p>
    <ul>
        <li>メールアドレスに誤りがないか（特にドメイン）</li>
        <li>迷惑メールフォルダやプロモーションタブへの振り分け</li>
        <li>ドメイン指定受信設定（@gmail.com等を受信可能か）</li>
    </ul>
</div>

            
            <button type="submit" class="submit-btn" id="submitBtn">送信する</button>
        </form>
    </div>
<script src="https://yubinbango.github.io/yubinbango/yubinbango.js" charset="UTF-8"></script>
<script src="https://www.google.com/recaptcha/enterprise.js?render=6Ld_w0QsAAAAAAzRMmb9rHYQZO24BQ3Qyr0RLr5C"></script>
<script>
        // GASのウェブアプリURLをここに設定してください
        const GAS_URL = 'https://script.google.com/macros/s/AKfycbzDNMouYtXS-ahYye6viBpEnvB__dnWwDHfaRFf5DkZ8boyviPRPTGWRMlmsM4nu2X_/exec';
        const RECAPTCHA_SITE_KEY = '6Ld_w0QsAAAAAAzRMmb9rHYQZO24BQ3Qyr0RLr5C';
    
        document.getElementById('membershipForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const submitBtn = document.getElementById('submitBtn');
            const messageDiv = document.getElementById('message');
            
            // --- ▼ ここから追加：送信前バリデーション ▼ ---
            const ownPolicyChecked = document.getElementById('own_policy').checked;
            const orgNameInput = document.getElementById('organization_name');
            const orgNameValue = orgNameInput.value.trim();

            if (ownPolicyChecked && orgNameValue === '') {
                messageDiv.textContent = '「他団体で加入済み」を選択した場合は、「団体名」を入力してください。';
                messageDiv.className = 'message error';
                messageDiv.style.display = 'block';
                orgNameInput.focus();
                setTimeout(() => {
                    messageDiv.style.display = 'none'; 
                }, 3000);
                return;
            }
            // ボタンを無効化
            submitBtn.disabled = true;
            submitBtn.textContent = 'セキュリティチェック中...';
        
        try {
            // --- ★ 追加：reCAPTCHA トークンの取得 ---
            // enterprise.execute を使ってトークンを発行します
            const token = await grecaptcha.enterprise.execute(RECAPTCHA_SITE_KEY, {action: 'submit'});

            // フォームデータを収集
            const formData = {
                timestamp: new Date().toISOString(),
                new_membership: document.getElementById('new_membership').value,
                status: document.getElementById('status').value,
                branch: document.getElementById('branch').value,
                furigana: document.getElementById('furigana').value,
                gender: document.getElementById('gender').value,
                name: document.getElementById('name').value,
                age: document.getElementById('age').value,
                postal: document.getElementById('postal').value,
                address1: document.getElementById('address1').value,
                address2: document.getElementById('address2').value,
                phone: document.getElementById('phone').value,
                fax: document.getElementById('fax').value,
                email: document.getElementById('email').value,
                category: document.getElementById('category').value,
                training_course: document.getElementById('training_course').checked,
                hop: document.getElementById('hop').checked,
                step: document.getElementById('step').checked,
                jump: document.getElementById('jump').checked,
                experience_years: document.getElementById('experience_years').value,
                other_experience: document.getElementById('other_experience').value,
                new_policy: document.getElementById('new_policy').checked,
                own_policy: document.getElementById('own_policy').checked,
                organization_name: document.getElementById('organization_name').value,
                contact_mail: document.getElementById('contact_mail').checked,
                contact_fax: document.getElementById('contact_fax').checked,
                contact_line: document.getElementById('contact_line').checked,
                contact_no_line: document.getElementById('contact_no_line').checked,
                
                // ★ 追加：取得したトークンをデータに含める
                recaptchaToken: token 
            };
            
            submitBtn.textContent = '送信中...';
        
            const response = await fetch(GAS_URL, {
                method: 'POST',
                body: JSON.stringify(formData),
            });
        
            const result = await response.json();
        
            if (result.status === 'success') {
                messageDiv.textContent = 'データを送信しました。自動返信メールをご確認ください。';
                messageDiv.className = 'message success';
                messageDiv.style.display = 'block';
                document.getElementById('membershipForm').reset();
            } else {
                // スコアが低くて弾かれた場合などもここに入ります
                throw new Error(result.message || '保存に失敗しました');
            }
        
        } catch (error) {
            console.error('Error:', error);
            messageDiv.textContent = 'エラーが発生しました: ' + error.message;
            messageDiv.className = 'message error';
            messageDiv.style.display = 'block';
        } finally {
            submitBtn.disabled = false;
            submitBtn.textContent = '送信する';
            
            setTimeout(() => {
                messageDiv.style.display = 'none';
            }, 5000);
        }
    });
</script>

</body>
</html>
